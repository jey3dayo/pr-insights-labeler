# 実装計画

## タスク概要

本実装計画は、「PR Labeler」から「PR Insights Labeler」へのプロダクト名改名とバージョン1.8.0へのインクリメントを実施します。すべてのドキュメント、設定ファイル、コードコメント、i18nメッセージ、ワークフローファイル、ステアリングドキュメントを統一的に更新し、既存機能の完全な後方互換性を維持します。

## 実装タスク

- [ ] 1. プロダクト名の包括的な置換作業
  - action.ymlのnameとdescriptionを「PR Insights Labeler」に更新
  - package.jsonのname（pr-insights-labeler）、description、keywordsを新プロダクト名に更新
  - README.mdとREADME.ja.mdの全プロダクト名参照を新プロダクト名に統一
  - docs/配下の全Markdownファイル（API.md、configuration.md、advanced-usage.md等）のプロダクト名を更新
  - ソースコード内のコメントでプロダクト名を参照している箇所を新プロダクト名に更新
  - _Requirements: 1_

- [ ] 1.1 i18nメッセージの完全統一
  - src/locales/en/common.jsonのフッター "Generated by [PR Labeler]..." → "Generated by [PR Insights Labeler]..."を更新
  - src/locales/en/logs.jsonの全ログメッセージ（starting, loading, applying, success等）のプロダクト名参照を更新
  - src/locales/ja/common.jsonのフッター "PR Labelerにより生成" → "PR Insights Labelerにより生成"を更新
  - src/locales/ja/logs.jsonの全ログメッセージ（開始、読み込み、適用、成功等）のプロダクト名参照を更新
  - ユーザー向け出力の一貫したブランド体験を提供
  - _Requirements: 1_

- [ ] 1.2 ワークフローファイルのプロダクト名更新
  - `.github/workflows/*.yml`のjob name、ステップ名、コメント内のプロダクト名参照を新プロダクト名に更新
  - 特に.github/workflows/quality.ymlのjob name "PR Labeler Self-Check" → "PR Insights Labeler Self-Check"を更新
  - ワークフロー履歴の継続性を維持しつつプロダクト名を統一
  - _Requirements: 1_

- [ ] 2. Kiroステアリングドキュメントの更新
  - .kiro/steering/product.mdのタイトル、プロダクト説明、updated_at（実装時の実際の日時、ISO 8601形式）を更新
  - .kiro/steering/structure.mdのタイトル、プロダクト名参照、updated_at（実装時の実際の日時、ISO 8601形式）を更新
  - .kiro/steering/tech.mdのタイトル、プロダクト名参照、updated_at（実装時の実際の日時、ISO 8601形式）を更新
  - 各ファイルで「PR Labeler」を「PR Insights Labeler」に置換（ルート名pr-labeler/は実リポジトリ名維持）
  - _Requirements: 7_

- [ ] 3. バージョン管理とCHANGELOG更新
  - package.jsonのversionフィールドを1.8.0に更新
  - CHANGELOG.mdに新バージョンエントリー「## [1.8.0] - YYYY-MM-DD」（実装時の実際の日付）を追加
  - CHANGELOGに改名の詳細（プロダクト名変更、後方互換性維持）をKeep a Changelog形式（### Changed）で記載
  - セマンティックバージョニングのカテゴリー（Changed）を使用し、リリース日付をYYYY-MM-DD形式で記録
  - _Requirements: 2, 8_

- [ ] 4. テストケースとスナップショットの更新
  - `__tests__/comment-manager.test.ts`内のプロダクト名参照を新プロダクト名に更新
  - `__tests__/report-formatter.test.ts`内のプロダクト名参照を新プロダクト名に更新
  - スナップショットテスト（`__tests__/__snapshots__/*.snap`）を更新（pnpm test:vitest --update）
  - 変更差分を確認し、意図した更新のみが含まれていることを検証
  - _Requirements: 6_

- [ ] 5. ビルドと品質保証
  - pnpm lintを実行してコードスタイルチェックを成功させる
  - pnpm type-checkを実行してTypeScript型チェックを成功させる
  - pnpm test:vitestを実行して全テストを成功させる
  - pnpm buildを実行してdist/index.js、dist/index.js.map、dist/licenses.txtを生成
  - grepまたはripgrepで「PR Labeler」の残存を確認（除外対象：.kiro/specs/rename-to-pr-insights-labeler/配下、CHANGELOG.mdの過去バージョンエントリー。これら以外にヒットしないことを確認）
  - _Requirements: 6_

- [ ] 6. 最終検証と整合性確認
  - action.ymlのbrandingセクション（icon: file-text、color: purple）が維持されていることを確認
  - action.ymlの全inputsとoutputsが変更されていないことを確認（後方互換性）
  - 既存のラベル命名規則（`size/_`, `complexity/_`, `category/_`, `risk/_`）が変更されていないことを確認
  - 既存の設定ファイル形式（.github/pr-labeler.yml、.github/directory-labeler.yml）が変更されていないことを確認
  - READMEとREADME.ja.mdでセクション構成が一致していることを確認
  - GitHub Actions Marketplaceで新プロダクト名が表示されることを確認（GitタグプッシュとRelease作成後）
  - _Requirements: 3, 4, 5_

## 実装上の注意事項

### 置換対象の明確化

- 置換対象文字列: 「PR Labeler」（スペース区切り、大文字小文字厳密）
- 置換後文字列: 「PR Insights Labeler」
- 除外対象:
  - .kiro/specs/rename-to-pr-insights-labeler/配下のファイル（本仕様書は改名前の名前を記録として保持）
  - CHANGELOG.mdの過去バージョンエントリー（履歴改ざん防止）

### 特殊ケースの処理

- package.jsonのnameフィールド: 「pr-labeler」→「pr-insights-labeler」（ケバブケース）
- READMEのタイトル: `# PR Labeler` → `# PR Insights Labeler`
- action.ymlのnameフィールド: `"PR Labeler"` → `"PR Insights Labeler"`
- ステアリングドキュメントのタイトル: `# Product Overview - PR Labeler` → `# Product Overview - PR Insights Labeler`
- i18nメッセージ: 英語・日本語両方でランタイム出力を完全統一（`src/locales/en/_.json`, `src/locales/ja/_.json`）
- ワークフローファイル: job名・ステップ名・コメント内のプロダクト名を更新

### 後方互換性の厳守

- GitHub Actions入力パラメータ（action.yml inputs）は一切変更しない
- ラベル命名規則（`size/_`, `complexity/_`, `category/_`, `risk/_`, `auto/*`）は変更しない
- 設定ファイル形式（.github/pr-labeler.yml、.github/directory-labeler.yml）は変更しない
- コメント投稿、GitHub Actions Summary出力の機能は変更しない
- action.ymlのbranding（icon: file-text、color: purple）は維持

### CI/CD検証

- フィーチャーブランチにプッシュ後、以下のGitHub Actions CIワークフローが全て成功することを確認：
  - Code Quality（lint + type-check）
  - Integration Tests（Node 20, 22）
  - Documentation Quality（Markdown変更時）
  - PR Metrics Self-Check
  - Quality Gate

### GitHub Marketplace更新

- Gitタグ（v1.8.0）をプッシュすると、GitHub Actions Marketplaceが自動的にaction.ymlから新プロダクト名を取得して表示を更新
- 手動操作は不要、Marketplace上でプロダクト名「PR Insights Labeler」が表示されることを確認

## テスト戦略

### ユニットテスト

- 既存の全ユニットテストが成功することを確認
- テストケース内のプロダクト名参照を新プロダクト名に更新
- スナップショットテストを更新（pnpm test:vitest --update）し、変更差分が意図した更新のみであることを検証

### 統合テスト

- `__tests__/integration.test.ts`: エンドツーエンドのワークフロー実行を確認
- `__tests__/index.test.ts`: メインエントリーポイントの統合動作を確認

### ビルド検証

1. pnpm lint → 成功
2. pnpm type-check → 成功
3. pnpm test:vitest → 全テスト成功
4. pnpm build → dist/index.js生成成功

### ドキュメント整合性テスト

```bash
# 「PR Labeler」の残存確認（置換漏れチェック）
grep -r "PR Labeler" --exclude-dir=node_modules --exclude-dir=dist --exclude-dir=.git .

# 期待結果: .kiro/specs/rename-to-pr-insights-labeler/配下のみヒット（本仕様書内の参照）
```

### CI/CD自動テスト

- .github/workflows/test-pr-labeler.yml: 自己適用ワークフローの成功確認
- .github/workflows/quality.yml: 品質ゲートの通過確認

## 完了基準

- [ ] 全ドキュメントで「PR Labeler」が「PR Insights Labeler」に置換されている
- [ ] i18nメッセージ（`src/locales/en/_.json`, `src/locales/ja/_.json`）で全プロダクト名参照が新プロダクト名に更新されている
- [ ] ワークフローファイル（`.github/workflows/*.yml`）のjob名・ステップ名が新プロダクト名に更新されている
- [ ] package.jsonのversionが1.8.0に更新されている
- [ ] CHANGELOG.mdに新バージョンエントリーが追加されている
- [ ] pnpm lint、pnpm type-check、pnpm test:vitestが全て成功している
- [ ] pnpm buildがエラーなくdist/index.jsを生成している
- [ ] grepで「PR Labeler」の残存が.kiro/specs/rename-to-pr-insights-labeler/配下のみであることを確認している
- [ ] GitHub Actions CIの全ワークフローが成功している
- [ ] action.ymlの入力・出力インターフェースが変更されていない（後方互換性維持）
- [ ] action.ymlのbrandingセクション（icon: file-text、color: purple）が維持されている
- [ ] ラベル命名規則、設定ファイル形式が変更されていない（後方互換性維持）
- [ ] GitHub Actions Marketplaceで新プロダクト名「PR Insights Labeler」が表示されている

## リリース手順

1. フィーチャーブランチで全タスクを実施
2. pnpm lint && pnpm type-check && pnpm test:vitest && pnpm buildを実行して全て成功することを確認
3. PRを作成し、GitHub Actions CIが全て成功することを確認
4. レビュー承認を取得
5. mainブランチにマージ
6. Gitタグv1.8.0を作成: `git tag -a v1.8.0 -m "v1.8.0"`
7. メジャーバージョンタグv1を更新: `git tag -f v1 v1.8.0^{}`
8. タグをプッシュ: `git push origin v1.8.0 && git push origin v1 --force`
9. GitHub Releaseを作成し、CHANGELOG.mdの新バージョンエントリーをリリースノートに転記
10. GitHub Actions Marketplaceで新プロダクト名の表示を確認
